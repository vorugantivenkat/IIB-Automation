CREATE DATABASE MODULE Mandate_Termination_Queryprocess_Database
	DECLARE DSN_NAME EXTERNAL CHARACTER;
	DECLARE SCHEMA_NAME EXTERNAL CHARACTER;
	DECLARE MANDATE_TABLE EXTERNAL CHARACTER;
	
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		
		IF Environment.dbQueryCount = '16' THEN		
			DECLARE MG ROW;
			SET MG.ID[] = SELECT M.MND_GP_HDR_MSGID FROM Database.{SCHEMA_NAME}.{MANDATE_TABLE} AS M WHERE M.MND_GP_HDR_MSGID = Environment.MsgId;
			SET Environment.ID = MG.ID.MND_GP_HDR_MSGID;
				
		ELSEIF Environment.dbQueryCount = '17' THEN
			
			UPDATE Database.{SCHEMA_NAME}.{MANDATE_TABLE} AS T SET MND_INTERFACE_CODE = 'MANDTTER',STATUS ='MNDT_TERMINATED',MND_GP_HDR_MSGID = Environment.MsgId,MSG_ID = Environment.Variables.CBOMsgId WHERE T.MNDT_REQID = Environment.OrignlMndtId;			
		END IF;
		RETURN TRUE;
	END;

END MODULE;